<!doctype HTML>
<html>
<head>
<title> Sequencer </title>
<meta name="viewport" content="user-scalable=0">
</head>

<body>
<script src = 'synth_library.js'></script>
<script src="jquery.js"></script>
<script>

//Global Variables
var playLoop;
var noteBank = [];
var sequencer_status = "paused";
var step = 1;


function generate_sequencer_ui() {

	for (s=0; s<8; s = s+1) {
		i = ((s+1) * 8) - 7;
		pad_layout = '<div class="pad" id="pad' + i + '"style="background-color:red; height:10%;"> <input type="number" id="pad' + i + 'freq" value="70"></div><div class="pad" id="pad' + (i+1) + '" style="background-color:orange;  height:10%;"><input type="number" id="pad' + (i+1) + 'freq" value="600"></div><div class="pad" id="pad' + (i+2) + '" style="background-color:yellow;  height:10%;"><input type="number" id="pad' + (i+2) + 'freq" value="700"></div><div class="pad" id="pad' + (i+3) + '" style="background-color:green;  height:10%;"><input type="number" id="pad' + (i+3) + 'freq" value="800"></div><div class="pad" id="pad' + (i+4) + '" style="background-color:blue;  height:10%;"><input type="number" id="pad' + (i+4) + 'freq" value="900"></div><div class="pad" id="pad' + (i+5) + '" style="background-color:purple;  height:10%;"><input type="number" id="pad' + (i+5) + 'freq" value="1000"></div><div class="pad" id="pad' + (i+6) + '" style="background-color:pink;  height:10%;"><input type="number" id="pad' + (i+6) + 'freq" value="1100"></div><div class="pad" id="pad' + (i+7) + '" style="background-color:white;  height:10%;"><input type="number" id="pad' + (i+7) + 'freq" value="200"></div><div class="step_light" id="step_light' + (s+1) + '" style="height:10%"></div>';
		if (s==0) {
			pad_layout = pad_layout +'<button type="button" id="play" style="width:100%; height:10%"> PLAY </button></div>';
		} else if (s == 1) {
			pad_layout = pad_layout +'<button type="button" id="pause" style="width:100%; height:10%">PAUSE </button></div>';
		} else if (s == 2) {
			pad_layout = pad_layout +'<button type="button" id="random" style="width:100%; height:10%">RANDOM STYLE 1</button></div>';
		}else if (s == 3) {
			pad_layout = pad_layout + '<button type="button" id="randomEvenSteven" style="width:100%; height:10%">RANDOM STYLE 2</button></div>';
		}else if (s == 6) {
			pad_layout = pad_layout + '<p> STEP DELAY ==> </p></div>';
		}else if (s == 7) {
			pad_layout = pad_layout +'<input type="number" id="tempoinput" value="160" style ="height:10%; width:100%"></div>';
		} else {
			pad_layout = pad_layout + '</div>';
		}
		
		$("#column"+ (s + 1)).append(pad_layout);
	}
}

// User Interface Event Handlers

$(document).ready(function(){
	
	generate_sequencer_ui();

	$("#pad1").on("mousedown", function() {
		noteToggle(1);
	});
	$("#pad2").on("mousedown", function() {
		noteToggle(2);
	});
	$("#pad3").on("mousedown", function() {
		noteToggle(3);
	});
	$("#pad4").on("mousedown", function() {
		noteToggle(4);
	});
	$("#pad5").on("mousedown", function() {
		noteToggle(5);
	});
	$("#pad6").on("mousedown", function() {
		noteToggle(6);
	});
	$("#pad7").on("mousedown", function() {
		noteToggle(7);
	});
	$("#pad8").on("mousedown", function() {
		noteToggle(8);
	});
	$("#pad9").on("mousedown", function() {
		noteToggle(9);
	});
	$("#pad10").on("mousedown", function() {
		noteToggle(10);
	});
	$("#pad11").on("mousedown", function() {
		noteToggle(11);
	});
	$("#pad12").on("mousedown", function() {
		noteToggle(12);
	});
	$("#pad13").on("mousedown", function() {
		noteToggle(13);
	});
	$("#pad14").on("mousedown", function() {
		noteToggle(14);
	});
	$("#pad15").on("mousedown", function() {
		noteToggle(15);
	});
	$("#pad16").on("mousedown", function() {
		noteToggle(16);
	});
	$("#pad17").on("mousedown", function() {
		noteToggle(17);
	});
	$("#pad18").on("mousedown", function() {
		noteToggle(18);
	});
	$("#pad19").on("mousedown", function() {
		noteToggle(19);
	});
	$("#pad20").on("mousedown", function() {
		noteToggle(20);
	});
	$("#pad21").on("mousedown", function() {
		noteToggle(21);
	});
	$("#pad22").on("mousedown", function() {
		noteToggle(22);
	});
	$("#pad23").on("mousedown", function() {
		noteToggle(23);
	});
	$("#pad24").on("mousedown", function() {
		noteToggle(24);
	});
	$("#pad25").on("mousedown", function() {
		noteToggle(25);
	});
	$("#pad26").on("mousedown", function() {
		noteToggle(26);
	});
	$("#pad27").on("mousedown", function() {
		noteToggle(27);
	});
	$("#pad28").on("mousedown", function() {
		noteToggle(28);
	});
	$("#pad29").on("mousedown", function() {
		noteToggle(29);
	});
	$("#pad30").on("mousedown", function() {
		noteToggle(30);
	});
	$("#pad31").on("mousedown", function() {
		noteToggle(31);
	});
	$("#pad32").on("mousedown", function() {
		noteToggle(32);
	});
	$("#pad33").on("mousedown", function() {
		noteToggle(33);
	});
	$("#pad34").on("mousedown", function() {
		noteToggle(34);
	});
	$("#pad35").on("mousedown", function() {
		noteToggle(35);
	});
	$("#pad36").on("mousedown", function() {
		noteToggle(36);
	});
	$("#pad37").on("mousedown", function() {
		noteToggle(37);
	});
	$("#pad38").on("mousedown", function() {
		noteToggle(38);
	});
	$("#pad39").on("mousedown", function() {
		noteToggle(39);
	});
	$("#pad40").on("mousedown", function() {
		noteToggle(40);
	});
	$("#pad41").on("mousedown", function() {
		noteToggle(41);
	});
	$("#pad42").on("mousedown", function() {
		noteToggle(42);
	});
	$("#pad43").on("mousedown", function() {
		noteToggle(43);
	});
	$("#pad44").on("mousedown", function() {
		noteToggle(44);
	});
	$("#pad45").on("mousedown", function() {
		noteToggle(45);
	});
	$("#pad46").on("mousedown", function() {
		noteToggle(46);
	});
	$("#pad47").on("mousedown", function() {
		noteToggle(47);
	});
	$("#pad48").on("mousedown", function() {
		noteToggle(48);
	});
	$("#pad49").on("mousedown", function() {
		noteToggle(49);
	});
	$("#pad50").on("mousedown", function() {
		noteToggle(50);
	});
	$("#pad51").on("mousedown", function() {
		noteToggle(51);
	});
	$("#pad52").on("mousedown", function() {
		noteToggle(52);
	});
	$("#pad53").on("mousedown", function() {
		noteToggle(53);
	});
	$("#pad54").on("mousedown", function() {
		noteToggle(54);
	});
	$("#pad55").on("mousedown", function() {
		noteToggle(55);
	});
	$("#pad56").on("mousedown", function() {
		noteToggle(56);
	});
	$("#pad57").on("mousedown", function() {
		noteToggle(57);
	});
	$("#pad58").on("mousedown", function() {
		noteToggle(58);
	});
	$("#pad59").on("mousedown", function() {
		noteToggle(59);
	});
	$("#pad60").on("mousedown", function() {
		noteToggle(60);
	});
	$("#pad61").on("mousedown", function() {
		noteToggle(61);
	});
	$("#pad62").on("mousedown", function() {
		noteToggle(62);
	});
	$("#pad63").on("mousedown", function() {
		noteToggle(63);
	});
	$("#pad64").on("mousedown", function() {
		noteToggle(64);
	});
	$("#play").on("click", function() {
		if (sequencer_status == "paused"){
			var tempo = $("#tempoinput").val();
			sequencer_status = "playing";
			playLoop = setInterval(function () {
				if (step == 9) {
					step = 1;
				} 
				for (i = step * 8 - 7; i <= step * 8; i = i + 1) {
					playNote(i);
				};
	
				step = step + 1;
	
				var steplightid = "#step_light" + step;
				$(steplightid).animate({
					opacity:1.0,
				}, 200, function() {
					$(steplightid).animate({
						opacity:.5
					}, 200);
				});
			},tempo);
		};
	});
	$("#pause").on("click", function() {
		pause();
	});
	$("#random").on("click", function() {
		randomNotes();
	});
	$("#randomEvenSteven").on("click", function() {
		randomNotesEvenSteven();
	});

});


//  Sequencer Functions
function play(){

	if (sequencer_status == "paused"){
		var tempo = $("#tempoinput").val();
		sequencer_status = "playing";
		playLoop = setInterval(stepPlay,tempo);
	};
};

function pause(){
	sequencer_status = "paused";
	clearInterval(playLoop);

};

function noteToggle(noteid){
	if (noteBank[noteid] != "on") {
		noteBank[noteid] = "on"
		$("#pad" + noteid).animate({
			opacity: 1
		});
	} else {
		noteBank[noteid] = "off";
		$("#pad" + noteid).animate({
			opacity: .5
		});
	};
};

function stepPlay() {
	if (step == 9) {
		step = 1;
	} 
	for (i = step * 8 - 7; i <= step * 8; i = i + 1) {
		playNote(i);
	};
	
	step = step + 1;
	
	var steplightid = "#step_light" + step;
	$(steplightid).animate({
		opacity:1.0,
	}, 200, function() {
		$(steplightid).animate({
			opacity:.5
		}, 200);
	});
};

function playNote(bank_number) {
	if (noteBank[bank_number] == "on") {
		freq = $("#pad"+bank_number+"freq").val();
		if (bank_number % 8 === 0) {
			bloopSound(freq);	
		} else if (bank_number == 7 || bank_number == 15 || bank_number == 23 || bank_number == 31 || bank_number == 39 || bank_number == 47 || bank_number == 55 || bank_number == 63) {
			sharpBass(freq)
		} else {
			dropSound(freq);
		};
	};
};

function randomNumber(min_range, max_range) {
	return Math.floor((Math.random() * max_range) + min_range);
};

function randomNotes() {
	for (i = 1; i < 9 ; i = i + 1) {
		for (j = i * 8 - 7; j <= i * 8; j = j + 1) {
			notevalue = randomNumber(i * 100 - 70, i * 100 + 60)
			$("#pad" + j + "freq").val(notevalue);
		};
	};
};

function randomNotesEvenSteven() {
	
	for (i = 1; i < 9 ; i = i + 1) {
		for (j = i * 8 - 7; j <= i * 8; j = j + 1) {
			min_range = Math.floor((j * 80 - 50) / i);
			max_range = Math.floor((j * 80 + 60) / i);
			notevalue = randomNumber(min_range, max_range)
			$("#pad" + j + "freq").val(notevalue);
		};
	};	
	
	
};

</script>

<! User Interface Layout - Set to resize and fit any sqreen>
<style>

div.step_light {

	border-width:0px;
	opacity:.5;
	background-color:Gold;
}

div.column {
	position:absolute;
	border-width:0px;
}

div.pad {

	border-width:1px;
	border-style:solid;
	border-color:black;
	opacity:.5;
	text-align: center;
}

input {

	width: 80%;
	
}

html, body{

	overflow:hidden;
	width: 100%;
	height:100%;
}


</style>



<div class="column" id="column1" style="width:12%; left:2%; height:80%">


</div>

<div class="column" id="column2" style="width:12%; left:14% ;height:80%">


</div>

<div class="column" id="column3" style="width:12%; left:26% ;height:80%">


</div>

<div class="column" id="column4" style="width:12%; left:38% ;height:80%">



</div>

<div class="column" id="column5" style="width:12%; left:50% ;height:80%">

</div>

<div class="column" id="column6" style="width:12%; left:62% ;height:80%">

</div>

<div class="column" id="column7" style="width:12%; left:74% ;height:80%">


</div>

<div class="column" id="column8" style="width:12%; left:86% ;height:80%">


</div>


</body>
</html>
